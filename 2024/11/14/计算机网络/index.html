<!DOCTYPE html>
<html lang="en">
    <head>
  <!-- 元数据 -->
  <meta charset="utf-8">
  
    <link rel="icon" href="/assets/favicon.png">
  
  
  <title>计算机网络 | Kid</title>
  <link rel="canonical" href="http://example.com/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
  <meta name="author" content="kid" />
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="robots" content="index,follow" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="format-detection" content="telphone=no, email=no" />
  
    <meta name="keywords" content="" />
  
  <meta name="description" content="先展示一下这个经典结构，然后用一个数据包的一生来逐一解释整个计算机网络 1.应用层解决的问题： 提供网络应用服务功能： 应用层直接面向用户，提供各种网络应用服务。它是用户与网络之间的接口，负责处理特定的应用程序协议（如HTTP、HTTPS、FTP、SMTP等），使用户能够通过网络进行通信。主要任务：  应用协议的实现：如HTTP（用于网页浏览）、FTP（用于文件传输）、SMTP（用于电子邮件）等。">
<meta property="og:type" content="article">
<meta property="og:title" content="计算机网络">
<meta property="og:url" content="http://example.com/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/index.html">
<meta property="og:site_name" content="Kid">
<meta property="og:description" content="先展示一下这个经典结构，然后用一个数据包的一生来逐一解释整个计算机网络 1.应用层解决的问题： 提供网络应用服务功能： 应用层直接面向用户，提供各种网络应用服务。它是用户与网络之间的接口，负责处理特定的应用程序协议（如HTTP、HTTPS、FTP、SMTP等），使用户能够通过网络进行通信。主要任务：  应用协议的实现：如HTTP（用于网页浏览）、FTP（用于文件传输）、SMTP（用于电子邮件）等。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://example.com/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/img_5.png">
<meta property="article:published_time" content="2024-11-14T15:00:00.000Z">
<meta property="article:modified_time" content="2025-06-28T09:08:01.473Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/img_5.png">
  
  <!-- 样式表文件 -->
  <link rel="stylesheet" id="kratos-css" href="/css/kr-core.min.css" media="all"></link>
  
    <link rel="stylesheet" id="highlight-css" href="/css/highlight/highlight.js/night-eighties.min.css" media="all"></link>
  
  <link rel="stylesheet" id="theme-light-css" href="/css/kr-theme/light.min.css" media="all"></link>
  <link rel="stylesheet" id="theme-dark-css" href="/css/kr-theme/dark.min.css" media="(prefers-color-scheme: dark)"></link>
  <script src="/js/kr-theme.min.js"></script>
  <link rel="stylesheet" id="fontawe-css" href="/vendors/font-awesome@4.7.0/css/font-awesome.min.css" media="all"></link>
  
    <link rel="stylesheet" id="nprogress-css" href="/vendors/nprogress@0.2.0/nprogress.css" media="all"></link>
  
  
    <link rel="stylesheet" href="/vendors/viewerjs@1.11.6/dist/viewer.min.css"></link>
  
  <!-- 不得不预先加载的一些JS文件 -->
  
    <script src="/vendors/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"></script>
  
  <!-- 自定义站点横幅和背景 -->
  <style>
    
      .kratos-cover.kratos-cover-2 {
        background-image: url('https://dev.krt.moe/demo-assets/banner.webp');
      }
      html[data-theme="dark"] .kratos-cover.kratos-cover-2 {
        background-image: url('https://dev.krt.moe/demo-assets/banner_dark.webp');
      }
    
    
      @media(min-width:768px) {
        body.custom-background {
          background-image: url('https://dev.krt.moe/demo-assets/bg.webp');
        }
        html[data-theme="dark"] body.custom-background {
          background-image: url('https://dev.krt.moe/demo-assets/bg.webp');
        }
      }
    
    
      .widget-kratos-about .photo-background {
        background-image: url('/images/default.webp');
      }
      html[data-theme="dark"] .widget-kratos-about .photo-background {
        background-image: url('/images/default.webp');
      }
    
  </style>

  <!-- 额外的追加注入项 -->
  
<meta name="generator" content="Hexo 7.3.0"></head>

    <body class="custom-background">
        <div id="kratos-wrapper">
    <div id="kratos-page">
        <div id="kratos-header">
            <header id="kratos-desktop-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="nav-header">
                        <nav id="kratos-menu-wrap">
                            <ul id="kratos-primary-menu" class="sf-menu">
                                
                                    <li>
                                        
                                            <a href="/">
                                        
                                            
                                                <i class="fa fa-home"></i>
                                            
                                            首页
                                        </a>
                                        
                                    </li>
                                
                                    <li>
                                        
                                            <a href="/archives/">
                                        
                                            
                                                <i class="fa fa-file"></i>
                                            
                                            档案馆
                                        </a>
                                        
                                    </li>
                                
                                    <li>
                                        
                                            <a href="/about">
                                        
                                            
                                                <i class="fa fa-info"></i>
                                            
                                            关于
                                        </a>
                                        
                                    </li>
                                
                            </ul>
                        </nav>
                    </div>
                </div>
            </header>
            <header id="kratos-mobile-topnav" class="kratos-topnav">
                <div class="container">
                    <div class="color-logo"><a href="/">Kid</a></div>
                    <div id="kratos-nav-toggle-wrapper" class="nav-toggle">
                        <a id="kratos-nav-toggle" class="kratos-nav-toggle">
                            <i></i>
                        </a>
                    </div>
                </div>
            </header>
        </div>
        <div class="kratos-start kratos-hero-2">
            <!-- <div class="kratos-overlay"></div> -->
            <div class="kratos-cover kratos-cover-2 text-center">
                <div class="desc desc2 animate-box">
                    <a href="/">
                        <h2>Kid</h2> <br />
                        <span></span>
                    </a>
                </div>
            </div>
        </div>

        <div id="kratos-blog-post">
            <div class="container">
                <div id="main" class="row">


        

            

            <section class="kr-main-col col-md-8">

        

            <article itemscope itemtype="https://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">
    <div class="kratos-hentry kratos-page-inner clearfix">
        <header class="kratos-page-header">
            
                <h1 class="kratos-page-title text-center" itemprop="name headline">计算机网络</h1>
            
            <ul class="kratos-page-meta text-center">
                <li><time datetime="2024-11-14T15:00:00.000Z" itemprop="datePublished"><i class="fa fa-calendar"></i> 2024-11-14</time></li>
                <li itemprop="author" itemscope itemtype="https://schema.org/Person">
                    <i class="fa fa-user"></i> 作者 <span itemprop="name">kid</span>
                </li>
                
                    <li>
                        <i class="fa fa-edit"></i> 
                        
                        
                            ~6.81K
                        
                        字
                    </li>
                
                
                
            </ul>
        </header>
        <div class="kratos-page-content kr-post">
            
            
            
            <hr />
            <div itemprop="articleBody"><p><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted-image-20241110190125.png" alt="计算机网络基本结构"><br>先展示一下这个经典结构，然后用一个数据包的一生来逐一解释整个计算机网络</p>
<h1 id="1-应用层"><a href="#1-应用层" class="headerlink" title="1.应用层"></a>1.应用层</h1><p><strong>解决的问题：</strong> 提供网络应用服务<br><strong>功能：</strong> 应用层直接面向用户，提供各种网络应用服务。它是用户与网络之间的接口，负责处理特定的应用程序协议（如HTTP、HTTPS、FTP、SMTP等），使用户能够通过网络进行通信。<br><strong>主要任务：</strong></p>
<ol>
<li>应用协议的实现：如HTTP（用于网页浏览）、FTP（用于文件传输）、SMTP（用于电子邮件）等。</li>
<li>数据格式的转换：将数据转换为应用程序能够理解的格式。</li>
<li>用户认证与授权：处理用户的身份验证和权限管理。</li>
<li>数据加密与解密：SSL&#x2F;TLS加密确保数据的安全性。</li>
</ol>
<h2 id="HTTP-Hypertext-Transfer-Protocol-超文本传输协议"><a href="#HTTP-Hypertext-Transfer-Protocol-超文本传输协议" class="headerlink" title="HTTP(Hypertext Transfer Protocol)超文本传输协议"></a>HTTP(Hypertext Transfer Protocol)超文本传输协议</h2><p>当我们打开一个网站时，会输入一个网址，这个网址就是url<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110220019.png"><br>url代表了我们要向服务器请求的资源，对url进行解析后，确定了请求信息，接下来就可以遵循HTTP协议把这些信息封装成一个HTTP请求，而请求主要是GET请求，POST请求，还有PUT请求，DELETE请求等，但是最常用的就是GET，POST请求，一个POST请求由请求行，请求头，请求头三部分构成，而GET请求没有请求体。</p>
<p>&#x3D;&#x3D;下图就是一个POST请求的报文形式。&#x3D;&#x3D;<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110221245.png"></p>
<p>这样一个请求数据包就诞生了，接下来就需要为他指路，让他知道请求的是哪个服务器</p>
<h2 id="DNS协议"><a href="#DNS协议" class="headerlink" title="DNS协议"></a>DNS协议</h2><p>我们平时打开网页时都是输入的网址，例如:<a target="_blank" rel="noopener" href="http://www.baidu.com/">www.baidu.com</a> 但是计算机是无法识别域名的，在计算机的网络中只有IP, MAC地址可以被解读，那么我们就要想办法将域名解析为服务器IP，这时候就用到了DNS解析。接下来讲解一下DNS解析的步骤。</p>
<ol>
<li><strong>第一步</strong><br>本地电脑会检查浏览器缓存中有没有这个域名对应的解析过的IP地址，如果缓存中有，这个解析过程就结束。浏览器缓存域名也是有限制的，不仅浏览器缓存大小有限制，而且缓存的时间也有限制，通常情况下为几分钟到几小时不等，域名被缓存的时间限制可以通过TTL属性来设置。这个缓存时间太长和太短都不太好，如果时间太长，一旦域名被解析到的IP有变化，会导致被客户端缓存的域名无法解析到变化后的IP地址，以致该域名不能正常解析，这段时间内有一部分用户无法访问网站。如果设置时间太短，会导致用户每次访问网站都要重新解析一次域名。</li>
<li><strong>第二步</strong><br>如果浏览器缓存中没有数据，浏览器会查找操作系统缓存中是否有这个域名对应的DNS解析结果。</li>
<li><strong>第三步</strong><br>前两个过程无法解析时，就要用到我们网络配置中的”DNS服务器地址”了。操作系统会把这个域名发送给这个本地DNS服务器。每个完整的内网通常都会配置本地DNS服务器。它们一般都会缓存域名解析结果，当然缓存时间是受到域名的失效时间控制的。大约80%的域名解析到这里就结束了，后续的DNS迭代和递归也是由本地DNS服务器负责。</li>
<li><strong>第四步</strong><br>如果本地DNS服务器仍然没有命中，就直接到根DNS服务器请求解析。</li>
<li><strong>第五步</strong><br>根DNS服务器返回给本地DNS域名服务器一个顶级DNS服务器地址，它是国际顶级域名服务器，如.com、.cn、.org等，全球只有13台左右。</li>
<li><strong>第六步</strong><br>本地DNS服务器再向上一步获得的顶级DNS服务器发送解析请求。接受请求的顶级DNS服务器查找并返回此域名对应的Name Server域名服务器的地址，这个Name Server服务器就是我要访问的网站域名提供商的服务器，其实该域名的解析任务就是由域名提供商的服务器来完成。   比如我要访问 <a target="_blank" rel="noopener" href="http://www.baidu.com,/">www.baidu.com，</a> 而这个域名是从A公司注册获得的，那么A公司上的服务器就会有<a target="_blank" rel="noopener" href="http://www.baidu.com的相关信息./">www.baidu.com的相关信息。</a></li>
<li><strong>第七步</strong><br>Name Server服务器会查询存储的域名和IP的映射关系表，再把查询出来的域名和IP地址等等信息，连同一个TTL值返回给本地DNS服务器。本地DNS服务器会缓存这个域名和IP的对应关系，缓存时间由TTL值控制。</li>
<li><strong>第八步</strong><br>把解析的结果返回给本地电脑，本地电脑根据TTL值缓存在本地系统缓存中，域名解析过程结束在实际的DNS解析过程中，可能还不止这10步，如Name Server可能有很多级，或者有一个GTM来负载均衡控制，这都有可能会影响域名解析过程</li>
</ol>
<p>&#x3D;&#x3D;下图为一个DNS解析的流程&#x3D;&#x3D;<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110223235.png"></p>
<p>这样数据包就找到了自己的目的地了。而HTTP(HTTPS)协议和DNS协议就是在&#x3D;&#x3D;应用层&#x3D;&#x3D;上的协议</p>
<h1 id="2-传输层"><a href="#2-传输层" class="headerlink" title="2.传输层"></a>2.传输层</h1><p><strong>解决的问题：</strong> 端到端的可靠传输<br><strong>功能：</strong> 传输层负责在源端和目的端之间提供可靠的、端到端的数据传输服务。它确保数据能够完整、正确地从发送方传输到接收方，并处理数据传输中的差错和流量控制。<br><strong>主要任务：</strong></p>
<ol>
<li>端口管理：通过端口号区分不同的应用程序（如HTTP使用端口80，HTTPS使用端口443）。</li>
<li>可靠传输：通过确认机制（如TCP的三次握手）确保数据包的可靠传输。</li>
<li>流量控制：防止发送方发送过多数据，导致接收方无法处理。</li>
<li>错误检测与恢复：通过重传机制确保丢失或损坏的数据包能够被重新发送。</li>
<li>数据分段与重组：将大数据分段传输，并在接收端重新组装。</li>
</ol>
<h2 id="TCP协议"><a href="#TCP协议" class="headerlink" title="TCP协议"></a>TCP协议</h2><h3 id="TCP连接"><a href="#TCP连接" class="headerlink" title="TCP连接"></a>TCP连接</h3><p>TCP协议就是工作在传输层上的协议，TCP协议是面向连接的可靠协议，所以在发送数据之前要先与目标服务器进行TCP连接，就是经典的三次握手，三次握手目的是保证双方都有发送和接收的能力。&#x3D;&#x3D;下图前三次就是建立握手的过程&#x3D;&#x3D;<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110224644.png"><br>&#x3D;&#x3D;下图是一个简单的TCP建立连接的模型&#x3D;&#x3D;<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110224730.png"><br>接下来解读一下TCP头部</p>
<h3 id="TCP头部字段"><a href="#TCP头部字段" class="headerlink" title="TCP头部字段"></a>TCP头部字段</h3><p><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110225009.png"><br>首先，源端口号和目标端口号是不可少的，如果没有这两个端口号，数据就不知道应该发给哪个应用。<br>接下来有包的序号，这个是为了解决包乱序的问题。<br>还有应该有的是确认号，目的是确认发出去对方是否有收到。如果没有收到就应该重新发送，直到送达，这个是为了解决丢包的问题。<br>接下来还有一些状态位。例如 SYN 是发起一个连接，ACK 是回复，RST 是重新连接，FIN 是结束连接等。TCP 是面向连接的，因而双方要维护连接的状态，这些带状态位的包的发送，会引起双方的状态变更。<br>还有一个重要的就是窗口大小。TCP 要做流量控制，通信双方各声明一个窗口（缓存大小），作用是为了解决发送方和接收方速度不同而导致的数据丢失问题,当发送方发送的太快,接收方来不及接受就会导致数据丢失。<br>除了做流量控制以外，TCP还会做拥塞控制，为了解决过多的数据注入到网络导致网络崩溃和超负荷问题。<br>接下来讲解一下流量控制和拥塞控制<br><strong>流量控制</strong><br>发送端会根据自己的实际情况发送数据，但因为接收端接收不过来的话，接收方只能把处理不过来的数据存在缓存区里。如果缓存区都满了对方还在疯狂发送数据，接收方只能把收到的数据包丢掉，这就造成了网络资源的浪费！典型的场景如以太网场景中10G设备向1G设备发TCP包。<br>为了防止这种现象的发生，TCP 提供一种机制可以让发送端根据接收端的实际接收能力控制发送的数据量。这就是所谓的流量控制。<br>它的具体操作是：<br>（1）接收端主机向发送端主机通知自已可以接收数据的大小；<br>（2）于是发送端会发送不超过这个限度的数据，该大小限度就被称作窗口大小。窗口大小的值由接收端主机决定，而在TCP 首部中，就有一个字段用来通知窗口大小<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110225641.png"><br>（3）接收主机将自己可以接收的缓冲区大小放入这个字段中通知给发送端，这个字段的值越大，说明网络的吞吐量越高。<br>不过，接收端的这个缓冲区一旦面临数据溢出时，窗口大小的值也会随之被设置为一个更小的值通知给发送端，从而控制数据发送量。也就是说，发送端主机会根据接收端主机的指示，对发送数据的量进行控制。这也就形成了一个完整的TCP流控制(流量控制)。当Window&#x3D;0时，即告知发送方停止发送数据。<br><strong>拥塞控制</strong><br>先了解两个概念：<br>拥塞窗口（cwnd）：发送方维持的一个状态变量，其大小取决于网络的拥塞程度，并且动态变化。<br>慢开始门限（ssthresh）：为了防止拥塞窗口cwnd的增长过大引起网络拥塞所设置的一个门限值。<br>通过四种算法实现拥塞管理：<br>1.慢开始<br>2.拥塞避免<br>3.超时重传（1988年TCP Tahoe版本，已废弃不用）<br>4.快重传（1990年Reno版本，在用）<br>5.快恢复（1990年Reno版本，在用）<br>也就是说发送方会动态判定网络状态并按照上述算法调整TCP的发包节奏，那么如何确认使用算法呢？如下：<br>当cwnd &lt; ssthresh时，使用慢开始算法；<br>当cwnd &gt; ssthresh时，停止使用慢开始算法而改用拥塞避免算法；<br>当cwnd &#x3D; ssthresh时，既可使用慢开始算法，也可使用拥塞避免算法。</p>
<ol>
<li><strong>慢开始</strong><br>发送方先探测网络拥塞程度，并不是一开始就发送大量的数据，发送方会根据拥塞程度增大拥塞窗口cwnd。<br>计算方法：每经过一个传输轮次cwnd值就加倍，让cwnd值呈指数增加。<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110231829.png"><br>如上图，大体过程：<br>1.当前发送方cwnd值为1，因此只能发送一个数据报文段（拥塞窗口cwnd值是几就能发送几个数据段）<br>2.接收方收到该数据报文段后回复一个确认报文段，发送方收到该确认报文后，将cwnd值变为2(加倍)；<br>3.发送方此时可以连续发送两个数据段，接收方收到该数据段后一次发回2个确认报文段；<br>4.发送方收到这两个确认报文后，将cwnd值加2变为4（加倍）后可以连续发送4个数据段，以此类推直至cwnd&#x3D;ssthresh。</li>
<li><strong>拥塞避免</strong><br>继上图达到cwnd≥ssthresh后采用该算法用来控制拥塞窗口的增长速率。<br>计算方法：每经过一个传输轮次cwnd值加1，让cwnd值呈线性缓慢增大。<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110232026.png"></li>
<li><strong>拥塞发生</strong><br>当网络发生拥塞丢包时（如图假定cwnd&#x3D;24）<br><strong>● 快重传和快恢复（1990年TCP Reno版本，在用）</strong><br>超时重传算法直接把cwnd减小到1太过强烈，若还能收到连续3个ACK说明网络质量没那么差。同时采用快重传和快恢复算法，过程如下：</li>
</ol>
<p>（1）当发送方连续收到3个重复确认时即执行“乘法减小”算法，把慢开始门限ssthresh 减半；<br>（2）由于发送方现在认为网络不那么差，于是把cwnd值设置为开始门限ssthresh 减半后的数值；<br>（3）开始执行拥塞避免算法 (“加法增大”)使拥塞窗口缓慢地线性增大。<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110232211.png"><br>这样就解释完了TCP协议的所有字段。</p>
<h3 id="TCP-分割数据"><a href="#TCP-分割数据" class="headerlink" title="TCP 分割数据"></a>TCP 分割数据</h3><p>如果 HTTP 请求消息比较长，超过了 MSS 的长度，这时 TCP 就需要把 HTTP 的数据拆解成一块块的数据发送，而不是一次性发送所有数据。<br>MTU：一个网络包的最大长度，以太网中一般为 1500 字节。<br>MSS：除去 IP 和 TCP 头部之后，一个网络包所能容纳的 TCP 数据的最大长度。<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110232538.png"></p>
<h3 id="TCP报文组装"><a href="#TCP报文组装" class="headerlink" title="TCP报文组装"></a>TCP报文组装</h3><p>将TCP报文和之前的HTTP报文组装在一起，TCP协议就完成了他的任务了。<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/Pasted%20image%2020241110232710.png"></p>
<h1 id="3-网络层"><a href="#3-网络层" class="headerlink" title="3.网络层"></a>3.网络层</h1><p><strong>解决的问题：</strong> 跨网络的路由与寻址<br><strong>功能：</strong> 网络层负责在不同网络之间传输数据包，并选择最佳路径将数据从源节点传输到目标节点。它处理逻辑地址（如IP地址）和路由选择问题。<br><strong>主要任务：</strong></p>
<ol>
<li>IP地址的分配与管理：为每个设备分配唯一的IP地址。</li>
<li>路由选择：根据路由表和路由协议，选择数据包从源到目的地的最佳路径。</li>
<li>数据包的转发：通过路由器将数据包从一个网络转发到另一个网络。</li>
<li>分组与重组：如果数据包过大，网络层可以将其分割成更小的包，并在接收端重新组装。</li>
</ol>
<h2 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h2><p>IP协议是工作在网络层的协议，为了让数据包知道他应该发送到哪里。<br>我们先看看 IP 报文头部的格式：<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/img.png"><br>在 IP 协议里面需要有源地址 IP 和 目标地址 IP：<br>源地址IP，即是客户端的 IP 地址。<br>目标地址，即通过 DNS 域名解析得到的 Web 服务器 IP。<br>其中的协议就是传输层所用的协议(TCP，UDP等)</p>
<h1 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h1><p><strong>解决的问题：</strong> 可靠的数据帧传输<br><strong>功能：</strong> 数据链路层负责在相邻节点之间可靠地传输数据帧，并处理物理层可能出现的错误。它将物理层的比特流组织成帧，并确保这些帧能够在同一局域网内正确传输。<br><strong>主要任务：</strong></p>
<ol>
<li>帧的封装和解封装：将数据封装成帧，添加头部和尾部（包括MAC地址等信息）。</li>
<li>错误检测与纠正：通过校验和等机制检测传输错误。</li>
<li>流量控制：防止发送方发送过多数据，导致接收方处理不过来。</li>
<li>介质访问控制（MAC）：控制设备如何在共享的传输介质上访问网络（如以太网中的CSMA&#x2F;CD机制）。</li>
</ol>
<h2 id="MAC地址与ARP协议"><a href="#MAC地址与ARP协议" class="headerlink" title="MAC地址与ARP协议"></a>MAC地址与ARP协议</h2><p>数据链路层最基本的服务是将源计算机网络层来的数据可靠的传输到相邻节点的目标计算机的网络层。为达到这一目的，数据链路层必须具备一系列相应的功能，主要有：如何将数据组合成数据块（在数据链路层中将这种数据块称为帧，帧是数据链路层的传送单位）；如何控制帧在物理信道上的传输，包括如何处理传输差错，如何调节发送速率以使之与接收方相匹配；在两个网路实体之间提供数据链路通路的建立、维持和释放管理。<br>而相邻节点之间的传输要依靠MAC地址进行，网络包还需要在 IP 头部的前面加上 MAC 头部。MAC 头部是以太网使用的头部，它包含了接收方和发送方的 MAC 地址等信息。在以太网环境中，数据的传输所依懒的是MAC地址而非IP地址，而将已知<strong>IP地址转换为MAC地址</strong>的工作是由ARP协议来完成的。<br>首先当数据要离开当前以太网时，主机要将数据发送到对应路由上，数据如果是第一次发送，并且主机不知道路由器的MAC地址，那么主机首先会发送一个ARP（Address Resolution Protocol）请求。这个ARP请求是一个广播帧，它包含以下信息：</p>
<ul>
<li>源MAC地址：发送ARP请求的主机的MAC地址。</li>
<li>源IP地址：发送ARP请求的主机的IP地址。</li>
<li>目标MAC地址：全F的广播地址（例如，FF:FF:FF:FF:FF:FF）。</li>
<li>目标IP地址：路由器的IP地址。</li>
</ul>
<p>在这个广播帧中，主机使用自己的IP地址和MAC地址，并且询问“拥有这个IP地址的主机的MAC地址是什么？”这样的询问是以广播的形式发送到整个局域网中，目的是为了找到与目标IP地址相对应的MAC地址。</p>
<p>因此，第一次发送广播时，主机实际上是在询问目标IP地址对应的MAC地址，而不是直接发送IP数据包。一旦路由器响应了ARP请求，主机就会得到路由器的MAC地址，并使用这个MAC地址来封装后续的数据包，然后发送给路由器。后续的数据包将包含以下信息：</p>
<ul>
<li>源MAC地址：主机的MAC地址。</li>
<li>目标MAC地址：路由器的MAC地址。</li>
<li>源IP地址：主机的IP地址。</li>
<li>目标IP地址：最终目的地的IP地址（可能是另一个网络上的主机或者互联网上的服务器）。</li>
</ul>
<p>所以第一次发送广播时，主机是使用自己的IP地址来查询路由器的MAC地址，这个查询是通过ARP请求完成的，而不是直接发送IP数据包。但是那岂不是每次发送数据都要先发一个去询问，这样太麻烦了，所以在后续操作系统会把本次查询结果放到一块叫做 ARP 缓存的内存空间留着以后用，不过缓存的时间就几分钟。也就是说，在发包时：<br>先查询 ARP 缓存，如果其中已经保存了对方的 MAC 地址，就不需要发送 ARP 查询，直接使用 ARP 缓存中的地址。<br>而当 ARP 缓存中不存在对方 MAC 地址时，则发送 ARP 广播查询。<br>缓存也有自己的时间，而且一直将缓存存在本机会浪费内存资源，所以我们需要用到交换机。<br>封装之后数据包变成了下面这个样子<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/img_2.png"></p>
<h2 id="交换机"><a href="#交换机" class="headerlink" title="交换机"></a>交换机</h2><p>交换机会根据数据帧中的MAC地址，通过查询交换机内部维护的MAC地址表，将数据帧从源设备转发到目的设备。当发送一次之后，交换机就会记住IP与MAC的对应关系，方便后续的查找。<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/img_1.png"></p>
<h2 id="路由器"><a href="#路由器" class="headerlink" title="路由器"></a>路由器</h2><p>路由器的基本功能是在不同的网络之间转发数据包。当一个数据包到达路由器时，路由器会根据数据包的目的IP地址，通过内部的路由表，路由器根据路由算法和路由协议来选择数据包转发的最佳路径，决定最佳的转发路径，并将数据包发送到下一个网络或目的地。下图是查询路由表决定转发路径<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/img_3.png"><br>路由器可以实现网络地址转换，允许私有网络中的设备使用内部IP地址访问外部网络（如互联网），同时对外隐藏内部网络的结构，这就是所谓的内网穿透。<br>现代路由器基本上都包含了交换机，所以家庭中有一台路由器就可以连接外网，去互联网冲浪，不需要额外的交换机。<br>最后整体封装流程如下<br><img src="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/img_4.png"></p>
<h1 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h1><p>整体流程大致如上，对于计算机网络来说，我真的没写多少东西，全写完太累了，还有很多细节问题需要你们自己探索，例如交换机与路由器分别工作在哪一层，HTTPS的加密方式，如何实现内网穿透，HTTP与RPC调用等等有趣的问题。计算机的世界是探索不完的，我感觉已经要似掉了wwww。</p>
</div>
        </div>
        
        <footer class="kratos-entry-footer clearfix">
            
            
            
                <div class="post-actions text-center clearfix" id="post-actions">
                
                    <a class="donate" href="javascript:;" onclick="krOpenDonateModal()"><i class="fa fa-bitcoin"></i> 打赏</a>
                
                
                    <a class="share" href="javascript:;" onclick="krOpenShareModal()"><i class="fa fa-share-alt"></i> 分享</a>
                
                </div>
            
            <div class="footer-tag clearfix">
                <div class="pull-left">
                <i class="fa fa-tags"></i>
                    
                </div>
                <div class="pull-date">
                    <time datetime="2025-06-28T09:08:01.473Z" itemprop="dateModified">最后编辑：2025-06-28</time>
                </div>
            </div>
        </footer>
    </div>
    
        <nav class="navigation post-navigation clearfix" role="navigation">
            
            <div class="nav-previous clearfix">
                <a title=" 树" href="/2024/11/09/树/"><i class="fa fa-angle-left"></i> 上一篇</a>
            </div>
            
            
            <div class="nav-next clearfix">
                <a title=" golang并发编程" href="/2024/12/17/golang并发编程/">下一篇 <i class="fa fa-angle-right"></i></a>
            </div>
            
        </nav>
    
    
        <div class="comment-post">
            
        </div>
    
</article>

        

            </section>

            
                

<section id="kratos-widget-area" class="col-md-4 hidden-xs hidden-sm">
    <!-- 文章和页面根据splitter来分割，没有的话就从头开始设置为sticky -->
    
    
                <aside id="krw-about" class="widget widget-kratos-about clearfix">
    <div class="photo-background"></div>
    <div class="photo-wrapper clearfix">
        <div class="photo-wrapper-tip text-center">
            <img class="about-photo" src="/image/img2.jpg" alt="John Doe" loading="lazy" decoding="auto" />
        </div>
    </div>
    <div class="textwidget">
        <p class="text-center"></p>
    </div>
    <div class="site-meta">
        <a class="meta-item" href="/archives/">
            <span class="title">
                文章
            </span>
            <span class="count">
                6
            </span>
        </a>
        <a class="meta-item" href="/categories/">
            <span class="title">
                分类
            </span>
            <span class="count">
                0
            </span>
        </a>
        <a class="meta-item" href="/tags/">
            <span class="title">
                标签
            </span>
            <span class="count">
                0
            </span>
        </a>
    </div>
</aside>
            
                    <div class="sticky-area">
                
                

            
                
            
                
  <aside id="krw-posts" class="widget widget-kratos-posts">
  <h4 class="widget-title"><i class="fa fa-file"></i>最新文章</h4>
  <div class="tab-content">
      <ul class="list-group">
        
        
          
          
            <a class="list-group-item" href="/2025/06/28/Android-Runtime/"><i class="fa fa-book"></i> Android_Runtime</a>
            
          
        
          
          
            <a class="list-group-item" href="/2025/05/18/%E6%AF%8F%E6%97%A5%E6%90%93%E5%AE%89%E5%8D%93%E7%BB%84%E4%BB%B6/"><i class="fa fa-book"></i> 每日搓安卓组件</a>
            
          
        
          
          
            <a class="list-group-item" href="/2024/12/17/golang%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"><i class="fa fa-book"></i> golang并发编程</a>
            
          
        
          
          
            <a class="list-group-item" href="/2024/11/14/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/"><i class="fa fa-book"></i> 计算机网络</a>
            
          
        
          
          
            <a class="list-group-item" href="/2024/11/09/%E6%A0%91/"><i class="fa fa-book"></i> 树</a>
            
          
        
          
            
      </ul>
  </div>
  </aside>

            
    </div>
</section>
            

        

                </div>
    </div>
</div>

<footer>
    <div id="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-md-offset-3 footer-list text-center">
                    <ul class="kratos-social-icons">
                        
                    </ul>
                    <ul class="kratos-copyright">
                        <div>
                            <li>&copy; 2025 Kid 版权所有.</li>
                            <li>本站已运行<span id="kr-since">Loading...</span></li>
                        </div>
                        <div>
                            <li>自豪地使用 <a href="https://github.com/Candinya/Kratos-Rebirth" target="_blank">Kratos:Rebirth</a> 主题</li>
                            <li>站点由 John Doe 用 <i class="fa fa-heart" style="color:#d43f57"></i> 搭建</li>
                        </div>
                        <!-- 额外的追加注入项 -->
                        
                    </ul>
                </div>
            </div>
        </div>
        <div class="kr-tool text-center">
            <div class="tool">
                
                    <div class="box search-box">
                        <a href="/search">
                            <span class="fa fa-search"></span>
                        </a>
                    </div>
                
                <div class="box theme-box" id="theme-toggle">
                    <span class="fa fa-adjust"></span>
                </div>
            </div>
            <div id="gotop-box" class="box gotop-box">
                <span class="fa fa-chevron-up"></span>
            </div>
        </div>
    </div>
</footer>
</div>
</div>


    <div id="kr-donate-modal" class="kr-modal">
    <div class="kr-modal-bg" onclick="krCloseDonateModal()"></div>
    <div class="kr-modal-content">
        <div class="kr-modal-header">
            <div class="kr-modal-icon">
                <i class="fa fa-bitcoin"></i>
            </div>
            <div class="kr-modal-title">打赏</div>
            <button class="kr-modal-close" onclick="krCloseDonateModal()">
                <i class="fa fa-times-circle"></i>
            </button>
        </div>
        <div class="kr-modal-body">
            <div class="kr-donate-message">打赏提示信息</div>
            <div class="kr-donate-qr" id="kr-donate-qr">
                
            </div>
            <div class="kr-donate-platforms">
                
            </div>
        </div>
    </div>
</div>
<script defer src="/js/kr-modal/donate.min.js"></script>




    <div id="kr-share-modal" class="kr-modal">
    <div class="kr-modal-bg" onclick="krCloseShareModal()"></div>
    <div class="kr-modal-content">
        <div class="kr-modal-header">
            <div class="kr-modal-icon">
                <i class="fa fa-share-alt"></i>
            </div>
            <div class="kr-modal-title">分享这一刻</div>
            <button class="kr-modal-close" onclick="krCloseShareModal()">
                <i class="fa fa-times-circle"></i>
            </button>
        </div>
        <div class="kr-modal-body">
            <div class="kr-share-message">让朋友们也来瞅瞅！</div>
            <div class="kr-share-qr" id="kr-share-qr"></div>
            <div class="kr-share-platforms">
                
                    <button class="kr-share-platform-button" style="color: #62b6e7;" title="喵窝" onclick="krShareModalOpenPlatform('https://github.com/kids1934')">
                        <svg fill="currentColor" width="18" height="18" viewBox="0 0 329 388"><path d="M0,36.226c0,-19.993 16.233,-36.226 36.226,-36.226c13.788,0 25.787,7.719 31.908,19.068l188.366,229.845l0,-111.259c-6.356,5.508 -14.645,8.843 -23.707,8.843c-19.994,0 -36.226,-16.232 -36.226,-36.226c-0,-8.551 2.968,-16.413 7.93,-22.613l-0.015,-0.013l56.614,-69.08c6.2,-11.073 18.047,-18.565 31.63,-18.565c19.994,0 36.227,16.233 36.227,36.226l-0,314.644c-0,19.994 -16.233,36.226 -36.227,36.226c-13.166,0 -24.701,-7.039 -31.044,-17.555l-189.229,-230.899l-0,212.228c-0,19.994 -16.233,36.226 -36.227,36.226c-19.993,0 -36.226,-16.232 -36.226,-36.226l0,-314.644Z" /></svg>
                    </button>
                
            </div>
        </div>
    </div>
</div>
<script defer src="/js/kr-modal/share.min.js"></script>



<!-- 额外的追加注入项 -->


        <script>
    if (!window.kr) {
        window.kr = {};
    }
    window.kr.notMobile = (!(navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)));
    window.kr.siteRoot = "/";
</script>


  <script defer src="/vendors/nprogress@0.2.0/nprogress.js"></script>



  <script defer src="/vendors/viewerjs@1.11.6/dist/viewer.min.js"></script>


<script defer src="/js/kr-core.min.js"></script>


  <script defer src="/js/kr-pjax.min.js"></script>


<!-- 额外的追加注入项 -->


    </body>
</html>